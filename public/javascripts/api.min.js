if(!window.foursqmap)window.foursqmap={key:"",url:"http://www.4sqmap.com/api/",init:function(a){this.key=a},jsonp:function(){var a=0;return function(b,c){var d="foursqmap_jsonp_"+a++;window[d]=function(){c.apply(this,arguments)};var e=document.createElement("script");e.src=b+d+"&key="+this.key;document.getElementsByTagName("HEAD")[0].appendChild(e)}}(),_getVenueIcon:function(a){return a.categories&&a.categories.length>0?a.categories[0].icon.prefix+a.categories[0].icon.sizes[1]+a.categories[0].icon.name:
"https://foursquare.com/img/categories/none.png"},_getVenueAddress:function(a,b){for(var c=[],b=b||["state","city","address"],d=0;d<3;d++)a.location[b[d]]&&c.push(a.location[b[d]]);return c.join(", ")},_getVenueDescription:function(a,b){var c="";c+='<img style="float:left; vertical-align:middle; margin:0 5px 0 0; padding:0" width="32" src="'+this._getVenueIcon(a)+'" />';c+='<a style="font-weight: bold;'+(b?"":"font-size: 120%")+'" target="_blank" href="https://foursquare.com/venue/'+a.id+'">'+a.name+
"</a>";a.categories&&a.categories.length>0&&(c+=" <b>"+a.categories[0].name+"</b>");c+="<br />";if(address=this._getVenueAddress(a))c+="<i>"+address+"</i><br />";a.stats&&(c+="<span>"+this._nString(a.stats.usersCount,"user")+'</span> <span style="margin-left: 5px">'+this._nString(a.stats.checkinsCount,"checkin")+'</span> <span style="margin-left: 5px">'+this._nString(a.stats.tipCount,"tip")+"</span><br />");return c},_getListItemDescription:function(a,b){var c=this._getVenueDescription(a.venue,b||
!1);a.photo&&(c+='<img style="margin: 0 5px 5px 0;" src="'+a.photo.sizes.items[1].url+'" width="117" height="117" align="left" />');if(a.tip){var d=a.tip,e=d.text;d.url&&(e=e.replace(/\[LINK\]/,"")+' <a target="_blank" href="'+d.url+'">Read more</a>.');c+="<div"+(b?' style="font-size:90%"':"")+'><a target="_blank" href="https://foursquare.com/item/'+d.id+'" style="color:#999; text-decoration: none; padding-left: 18px; background: url(https://d3t9wmuxo47dud.cloudfront.net/img/tipDoneCheckGrey-6d501a6d0a6821ff8d808db9546eca37.png) no-repeat left center">Done by '+
d.done.count+(d.done.count==1?" person":" people")+"</a> "+e+'<div><a target="_blank" href="https://foursquare.com/user/'+d.user.id+'"><img align="left" src="'+d.user.photo+'" width="18" height="18" style="padding:0;margin:0 3px 0 0" /> '+(d.user.firstName+(d.user.lastName?" "+d.user.lastName:""))+"</a> <i>"+(new Date(d.createdAt*1E3)).toDateString()+"</i></div></div>"}c+=b?'<br clear="left" />':"";return c},_nString:function(a,b){return a+" "+b+(a==1?"":"s")},venuesMap:function(a){document.getElementById(a)&&
this.jsonp(this.url+"venues/map?callback=",function(b){for(var c=c||{},c=new google.maps.Map(document.getElementById(a),{zoom:c.zoom||10,center:new google.maps.LatLng(55.7,37.6),mapTypeId:c.mapTypeId||google.maps.MapTypeId.ROADMAP,minZoom:c.minZoom||2}),d=new google.maps.InfoWindow,e=0;e<b.length;e++){var f=new google.maps.Marker({map:c,position:new google.maps.LatLng(b[e].location.lat,b[e].location.lng),title:b[e].name,icon:new google.maps.MarkerImage(b[e].icon,null,null,null,new google.maps.Size(20,
20))});google.maps.event.addListener(f,"click",function(a,b){return function(){d.setContent("<div>"+b.name+"</div>");d.open(a,this)}}(c,b[e]))}})},lists:function(a,b,c){if(typeof b=="string"||b instanceof Array)if(b={list:b},c)for(var d in c)b[d]=c[d];if(document.getElementById(a)){var e=new google.maps.Map(document.getElementById(a),{zoom:b.zoom||2,center:new google.maps.LatLng(0,0),mapTypeId:b.mapTypeId||google.maps.MapTypeId.ROADMAP,minZoom:b.minZoom||2,scrollwheel:b.scrollwheel||!0}),f=new google.maps.InfoWindow({maxWidth:545}),
i=new google.maps.LatLngBounds,g=b.sidebar?document.getElementById(b.sidebar):!1;if(g)g.innerHTML="";c=b.list;c instanceof Array||(c=[c]);for(d=0;d<c.length;d++)this.jsonp(this.url+"lists?id="+c[d]+"&callback=",function(a){for(var c=0;c<a.response.listItems.items.length;c++){var d=a.response.listItems.items[c],j=new google.maps.Marker({map:e,position:new google.maps.LatLng(d.venue.location.lat,d.venue.location.lng),title:d.venue.name,icon:new google.maps.MarkerImage(foursqmap._getVenueIcon(d.venue),
null,null,null,new google.maps.Size(b.icon_size||25,b.icon_size||25))});google.maps.event.addListener(j,"click",function(a,b){return function(){f.setContent(foursqmap._getListItemDescription(b));f.open(a,this)}}(e,d));i=i.extend(j.getPosition());if(g){var h=document.createElement("div");h.style.cursor="pointer";h.innerHTML=foursqmap._getListItemDescription(d,!0);(function(a){google.maps.event.addDomListener(h,"click",function(){google.maps.event.trigger(a,"click");return!1})})(j);g.appendChild(h)}}e.fitBounds(i)})}else google.maps.event.addDomListener(window,
"load",function(){foursqmap.lists(a,b)})}};
